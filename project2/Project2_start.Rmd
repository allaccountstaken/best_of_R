---
title: 'STAT 6021: Project 2'
author: "Connie Cui"
date: "11/26/2021"
output:
  html_document:
    df_print: paged
  html_notebook: default
---


Load in packages
```{r}
library(tidyverse)
library(ggplot2)
```
import data:
```{r}
house <- read.csv("house_data.csv")
head(house)
```
find missing data:
```{r}
# list rows of data that have missing values
house[!complete.cases(house),]
```
No missing data.
Check data types of each variable:
```{r}
str(house)
```
We will definitely need to change the data type for the date column, and potentially look into creating factors for some of the more ordinal variables.
```{r}
house$date = substr(house$date,1,nchar(house$date)-7)
head(house)
```
Convert date variabe to date type:
```{r}
house$date <- as.Date(house$date, "%Y%m%d")
head(house)
```
Turning view, condition, and grade into ordered factors:
```{r}
house$view <- factor(house$view, ordered = TRUE, levels = c(0, 1, 2, 3, 4))
house$condition <- factor(house$condition, ordered = TRUE, levels = c(1, 2, 3, 4, 5))
house$grade <- factor(house$grade, ordered = TRUE, levels = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15))
house$waterfront <- factor(house$waterfront, ordered = TRUE, levels = c(0, 1))
```



## Part 2: EDA

```{r}
#install.packages("ggcorrplot")
#install.packages("miscset")
library(miscset)
library(Hmisc)
library(tidyverse)
library(dplyr)
library(faraway)
library(gridExtra)
```

```{r}
names(house)
```

#### Prior to dropping Date and Geotags consider using them for plotting, for example transaction counts by dates?


```{r}
house <- subset(house, select=-c(id,num, date, zipcode, lat, long))
names(house)
```

```{r}
describe(house)
```


```{r}
ggplot(house, aes(x=sqft_living, y=price, color=waterfront))+
  geom_point()+
  geom_smooth(method = "lm", se=FALSE)+
  labs(x="sqft_living", 
       y="price",
       title="Scatter plot of price against sqft_living with waterfornt indicator")
```


```{r}
ggplot(house, aes(x=sqft_living, y=price, color=view))+
  geom_point()+
  geom_smooth(method = "lm", se=FALSE)+
  labs(x="sqft_living", 
       y="price",
       title="Scatter plot of price against sqft_living with view indicator")
```


```{r}
ggplot(house, aes(x=sqft_living, y=price, color=condition))+
  geom_point()+
  geom_smooth(method = "lm", se=FALSE)+
  labs(x="sqft_living", 
       y="price",
       title="Scatter plot of price against sqft_living with condition indicator")
```


```{r}
ggplot(house, aes(x=sqft_living, y=price, color=grade))+
  geom_point()+
  geom_smooth(method = "lm", se=FALSE)+
  labs(x="sqft_living", 
       y="price",
       title="Scatter plot of price against sqft_living with grade indicator")
```

#### Question: how to deal with indicator (ordinary) varibales in this case?


```{r}
quant_vars = c("yr_built", "yr_renovated",
               "floors", "bedrooms", "bathrooms", 
               "sqft_living", "sqft_lot", "sqft_above", "sqft_basement", 
               "sqft_living15", "sqft_lot15")

cat_vars = c("waterfront", "view", "condition", "grade")

library(Hmisc)
hist.data.frame(house[,quant_vars])
```

```{r}
ggplotGrid(ncol = 2,
  lapply(c("view", "waterfront", "condition", "grade"),
    function(col) {
        ggplot(house, aes_string(col)) + geom_bar() + coord_flip()
    }))
```

```{r}
ggplot(house, aes(x=waterfront, y=price))+
geom_boxplot()+
labs(x="waterfront", y="price", title="Price by waterfront")
```




```{r}
ggplot(house, aes(x=view, y=price))+
geom_boxplot()+
labs(x="view", y="price", title="Price by view")
```


```{r}
ggplot(house, aes(x=condition, y=price))+
geom_boxplot()+
labs(x="condition", y="price", title="Price by condition")
```


```{r}
ggplot(house, aes(x=grade, y=price))+
geom_boxplot()+
labs(x="grade", y="price", title="Price by grade")
```



```{r}
head(house)
```

```{r}
# Changing `view` to 0 for regular view and 1 for every other view
house$view <- factor(ifelse(house$view!=0, 1, 0))
# Changing `condition` to 0 for everything below 3 and 1 otherwise
house$condition <- factor(ifelse(house$condition==1 | house$condition==2 | house$condition==3, 0, 1))
# Changing `grade` to 0 for everything below 7 and 1 otherwise
house$grade <- factor(ifelse(house$grade==1 | house$grade==2 | house$grade==3 |
                      house$grade==4 | house$grade==5 | house$grade==7 , 0, 1))
```


```{r}
ggplotGrid(ncol = 2,
  lapply(c("view", "waterfront", "condition", "grade"),
    function(col) {
        ggplot(house, aes_string(col)) + geom_bar() + coord_flip()
    }))
```

#### Checking possible interactions after mapping categorical variables to a larger classes

```{r}
ggplot(house, aes(x=sqft_living, y=price, color=view))+
  geom_point()+
  geom_smooth(method = "lm", se=FALSE)+
  labs(x="sqft_living", 
       y="price",
       title="Scatter plot of price against sqft_living with view indicator")
```
```{r}
ggplot(house, aes(x=sqft_living, y=price, color=condition))+
  geom_point()+
  geom_smooth(method = "lm", se=FALSE)+
  labs(x="sqft_living", 
       y="price",
       title="Scatter plot of price against sqft_living with condition indicator")
```


```{r}
ggplot(house, aes(x=sqft_living, y=price, color=grade))+
  geom_point()+
  geom_smooth(method = "lm", se=FALSE)+
  labs(x="sqft_living", 
       y="price",
       title="Scatter plot of price against sqft_living with grade indicator")
```



#### Converting quantitative predictor floors to a factor 1, 2, 3.


```{r}
house$floors <- factor(ifelse(house$floors < 2, 1, ifelse(house$floors < 3, 2, ifelse(house$floors>=3, 3, 0))))
```



```{r}
ggplot(house, aes(x=sqft_living, y=price, color=floors))+
  geom_point()+
  geom_smooth(method = "lm", se=FALSE)+
  labs(x="sqft_living", 
       y="price",
       title="Scatter plot of price against sqft_living with floors indicator")
```


#### Computing age of the house

```{r}
house$age = ifelse(2021-house$yr_renovated >= 2021-house$yr_built, 2021-house$yr_built, 2021-house$yr_renovated)
head(house)
```

```{r}
hist(house$bathrooms)
unique((house$bathrooms))
```

```{r}
house <- subset(house, select=-c(yr_renovated, yr_built))
head(house)
```


#### Other stuff 


```{r}
dp1<-ggplot(house, aes(x=sqft_living, color=waterfront))+
geom_density()+
labs(title="Sqft_living by waterfront")


dp2<-ggplot(house,aes(x=sqft_lot, color=waterfront))+
geom_density()+
labs(title="Sqft_lot by waterfront")


dp3<-ggplot(house,aes(x=sqft_above, color=waterfront))+
geom_density()+
labs(title="Sqft_above by waterfront")


dp4<-ggplot(house,aes(x=sqft_basement, color=waterfront))+
geom_density()+
labs(title="Sqft_basement by waterfront")

dp5<-ggplot(house,aes(x=sqft_living15, color=waterfront))+
geom_density()+
labs(title="Sqft_living15 by waterfront")


dp6<-ggplot(house,aes(x=sqft_lot15, color=waterfront))+
geom_density()+
labs(title="Sqft_lot15 by waterfront")


##produce the 4 density plots in a 2 by 2 matrix
grid.arrange(dp1, dp2, dp3, dp4, dp5, dp6, ncol = 2, nrow = 3)
```

               


```{r}
dp1<-ggplot(house, aes(x=yr_built, color=waterfront))+
geom_density()+
labs(title="Yr_built by waterfront")


dp2<-ggplot(house,aes(x=yr_renovated, color=waterfront))+
geom_density()+
labs(title="Yr_renovated by waterfront")


dp3<-ggplot(house,aes(x=floors, color=waterfront))+
geom_density()+
labs(title="Floors by waterfront")


dp4<-ggplot(house,aes(x=bedrooms, color=waterfront))+
geom_density()+
labs(title="Bedrooms by waterfront")

dp5<-ggplot(house,aes(x=bathrooms, color=waterfront))+
geom_density()+
labs(title="Bathrooms by waterfront")


dp6<-ggplot(house,aes(x=grade, color=waterfront))+
geom_density()+
labs(title="Grade by waterfront")


##produce the 4 density plots in a 2 by 2 matrix
grid.arrange(dp1, dp2, dp3, dp4, dp5, dp6, ncol = 2, nrow = 3)
```


```{r}
corr <- round(cor(house[,c("price",quant_vars)]), 1)
#head(corr[, 1:6])
library(ggcorrplot)
ggcorrplot(corr, 
           method = "circle", 
           lab = TRUE,
           type = "lower", 
           outline.color = "white", 
           ggtheme = ggplot2::theme_gray,
           colors = c("#6D9EC1", "white", "#E46726"))
```





## TODO: interpreting models https://cran.r-project.org/web/packages/jtools/vignettes/summ.html

```{r}
fit <- lm(price ~ ., data = house)
summary(fit)
```

```{r}
plot(fit)
```





```{r}

reduced <- lm(price ~ sqft_living+bedrooms+bathrooms+floors+waterfront+yr_built+sqft_living15+sqft_lot15, 
              data = house)
summary(reduced)
```


```{r}
plot(reduced)
```



```{r}
tiny <- lm(price ~ sqft_living15+bathrooms+waterfront, 
              data = house)
summary(tiny)
```



```{r}
plot(tiny)
```



```{r}
plot(house$price, house$sqft_living)
```

```{r}
plot(house$price, house$bathrooms)
```



```{r}
install.packages("plotly")
```




```{r}

library(plotly)
fig = list(
  data = list(
    list(
      x = house$floors,
      y = house$bedrooms,
      type = 'bar'
    )
  ),
  layout = list(
    title = 'A Figure Specified By R List',
    plot_bgcolor='#e5ecf6', 
         xaxis = list( 
           zerolinecolor = '#ffff', 
           zerolinewidth = 2, 
           gridcolor = 'ffff'), 
         yaxis = list( 
           zerolinecolor = '#ffff', 
           zerolinewidth = 2, 
           gridcolor = 'ffff')
  )
)
# To display the figure defined by this list, use the plotly_build function
plotly_build(fig)
```




